var browseImages = [
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image1.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image2.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image3.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image4.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image5.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image6.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image7.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image8.jpg"},
]

var recentImages = [
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image1.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image2.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image3.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image4.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image5.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image6.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image7.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image8.jpg"},
]

var favoriteImages = [
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image1.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image2.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image3.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image4.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image5.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image6.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image7.jpg"},
    {"url": "https://c59b285ada27f89b9f8d-3eb81b6eb5bfb6eff5a10a4aa6a00a8f.ssl.cf2.rackcdn.com/extra-content/gallery-image8.jpg"},
]

var backgroundImages = [
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape1.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape2.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape3.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape4.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape5.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape6.png"},
    {"url": "https://97ef80c3dd73167a36b8-170a2364f5ad6ce92aa698d6ee4aeaa4.ssl.cf2.rackcdn.com/default/background-design/background-shape7.png"},

]

window.selectItems = {
    'bg-advance-sort-select':[
        {
            id: 0,
            text: '<div class="options-style"><span class="name">Sort by:</span></div>',
            title: 'sort'
        },
        {
            id: 1,
            text: '<div class="options-style"><span class="name">Sort by:</span><span class="text">Random</span></div>',
            title: 'random'
        },
        {
            id: 2,
            text: '<div class="options-style"><span class="name">Sort by:</span><span' +
            ' class="text">Most Recent</span></div>',
                title: 'recent'
        },
        {
            id: 3,
            text: '<div class="options-style"><span class="name">Sort by:</span><span' +
            ' class="text">Most Popular</span></div>',
            title: 'popular'
        },
    ],

    'select-bg-repeat':[
        {
            id: 'no-repeat',
            text: '<div class="bg-options-style">No Repeat</div>',
            title: 'No Repeat'
        },
        {
            id: 'repeat',
            text: '<div class="bg-options-style">Repeat</div>',
            title: 'repeat'
        },
        {
            id: 'repeat-x',
            text: '<div class="bg-options-style">Repeat-X</div>',
            title: 'Repeat-X'
        },
        {
            id: 'repeat-y',
            text: '<div class="bg-options-style">Repeat-Y</div>',
            title: 'Repeat-Y'
        },
    ],

    'select-bg-position':[
        {
            id: 'center-right',
            text: '<div class="bg-options-style">Center Right</div>',
            title: 'Center Right'
        },
        {
            id: 'center-left',
            text: '<div class="bg-options-style">Center Left</div>',
            title: 'Center Left'
        },
        {
            id: 'center-center',
            text: '<div class="bg-options-style">Center Center</div>',
            title: 'Center Center'
        },
        {
            id: 'top-center',
            text: '<div class="bg-options-style">Top Center</div>',
            title: 'Top Center'
        },
        {
            id: 'top-left',
            text: '<div class="bg-options-style">Top Left</div>',
            title: 'Top Left'
        },
        {
            id: 'top-right',
            text: '<div class="bg-options-style">Top Right</div>',
            title: 'Top Right'
        },
        {
            id: 'bottom-center',
            text: '<div class="bg-options-style">Bottom Center</div>',
            title: 'Bottom Center'
        },
        {
            id: 'bottom-left',
            text: '<div class="bg-options-style">Bottom Left</div>',
            title: 'Bottom Left'
        },
        {
            id: 'bottom-right',
            text: '<div class="bg-options-style">Bottom Right</div>',
            title: 'Bottom Right'
        },
    ],

    'select-bg-size':[
        {
            id: 'cover',
            text: '<div class="bg-options-style">Cover</div>',
            title: 'Cover'
        },
        {
            id: 'contain',
            text: '<div class="bg-options-style">Contain</div>',
            title: 'Contain'
        },
        {
            id: 'default',
            text: '<div class="bg-options-style">Default</div>',
            title: 'Default'
        },
    ]
};

var bgAdvance = {

    bg_advance_select_list : [
        {selecter:".bg-advance-sort-select", parent:".bg-advance-sort-parent"},
        {selecter:".select-bg-repeat", parent:".select-bg-repeat-parent"},
        {selecter:".select-bg-position", parent:".select-bg-position-parent"},
        {selecter:".select-bg-size", parent:".select-bg-size-parent"},
    ],

    /*
    ** custom select loop
    **/
    allCustomSelect: function () {
        var selectlist = bgAdvance.bg_advance_select_list;
        for(var i = 0; i < selectlist.length; i++){
            bgAdvance.initCustomSelect(selectlist[i].selecter,selectlist[i].parent);
        }
    },

    /*
    ** init custom select
    **/
    initCustomSelect: function (selecter,parent) {
        var amIclosing = false;
        var _selector = jQuery(selecter);
        var _parent = jQuery(parent);
        var selectorClass = selecter.replace(/[#.]/g,'');
        _selector.select2({
            data: selectItems[selectorClass],
            minimumResultsForSearch: -1,
            dropdownParent: jQuery(parent),
            width: '100%',
            templateResult: function (d) {
                return $(d.text);
            },
            templateSelection: function (d) {
                return $(d.text);
            }

            /*
            ** Triggered before the drop-down is opened.
            */
        }).on('select2:opening', function() {
            _parent.find('.select2-selection__rendered').css('opacity', '0');

            /*
            ** Triggered whenever the drop-down is opened.
            ** select2:opening is fired before this and can be prevented.
            */
        }).on('select2:open', function() {
            var _selectoptions = _parent.find('.select2-results__options');
            var _selectdropdown = _parent.find('.select2-dropdown');

            _selectoptions.css('pointer-events', 'none');

            setTimeout(function() {
                _selectoptions.css('pointer-events', 'auto');
            }, 300);

            _selectdropdown.hide();
            _selectdropdown.css({'display': 'block', 'opacity': '1', 'transform': 'scale(1, 1)'});
            _parent.find('.select2-selection__rendered').hide();
            lpUtilities.niceScroll();
            setTimeout(function () {
                _parent.find('.select2-dropdown .nicescroll-rails-vr').each(function () {
                    var getindex = _selector.find(':selected').index();
                    var defaultHeight = 44;
                    var scrolledArea = getindex * defaultHeight;
                    jQuery(".select2-results__options").getNiceScroll(0).doScrollTop(scrolledArea);
                });
            }, 100);

            /*
            ** Triggered before the drop-down is closed.
            */
        }).on('select2:closing', function(e) {
            if(!amIclosing) {
                e.preventDefault();
                amIclosing = true;

                _parent.find('.select2-dropdown').attr('style', '');
                setTimeout(function () {
                    _selector.select2("close");
                }, 200);
            } else {
                amIclosing = false;
            }

            /*
            ** Triggered whenever the drop-down is closed.
            ** select2:closing is fired before this and can be prevented.
            */
        }).on('select2:close', function() {
            _parent.find('.select2-selection__rendered').show();
            _parent.find('.select2-selection__rendered').css('opacity', '1');
            _parent.find('.select2-results__options').css('pointer-events', 'none');
        });

        if(selectorClass == 'bg-advance-sort-select') {
            $(selecter).val(1).change();
        }
    },

    /* browse images fuction */
    browse_images: function () {
        var urlList = jQuery('#browse-images');
        browseImages.map( (item,i) => {
            jQuery(`<li class="gallery-list__item">
                        <div class="gallery-list__holder">
                            <div class="gallery-list__overlay">
                                <div class="gallery-list__overlay__box">
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__selection">
                                            <span class="gallery-list__selection__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-check"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">SELECT</span>
                                            </span>
                                            <span class="gallery-list__selection__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">DESELECT</span>
                                            </span>
                                        </a>
                                    </div>
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__favourite">
                                            <span class="gallery-list__favourite__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-start-rate"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">mark as favorite</span>
                                            </span>
                                            <span class="gallery-list__favourite__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">unmark favorite</span>
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span class="gallery-list__item__selected">
                                <i class="icon ico-check"></i>
                            </span>
                            <span class="gallery-list__overlay__favourite">
                                <i class="icon ico-start-rate"></i>
                            </span>
                            <img src="${item.url}" alt="gallery image">
                        </div>
                    </li>`).appendTo(urlList);
        });
    },

    /* browse recent images fuction */
    recent_images: function () {
        var urlList = jQuery('#recent-images');
        recentImages.map( (item,i) => {
            jQuery(`<li class="gallery-list__item">
                        <div class="gallery-list__holder">
                            <div class="gallery-list__overlay">
                                <div class="gallery-list__overlay__box">
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__selection">
                                            <span class="gallery-list__selection__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-check"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">SELECT</span>
                                            </span>
                                            <span class="gallery-list__selection__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">DESELECT</span>
                                            </span>
                                        </a>
                                    </div>
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__favourite">
                                            <span class="gallery-list__favourite__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-start-rate"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">mark as favorite</span>
                                            </span>
                                            <span class="gallery-list__favourite__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">unmark favorite</span>
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span class="gallery-list__item__selected">
                                <i class="icon ico-check"></i>
                            </span>
                            <span class="gallery-list__overlay__favourite">
                                <i class="icon ico-start-rate"></i>
                            </span>
                            <img src="${item.url}" alt="gallery image">
                        </div>
                    </li>`).appendTo(urlList);
        });
    },

    /* browse favorite images fuction */
    favorite_images: function () {
        var urlList = jQuery('#favorite-images');
        favoriteImages.map( (item,i) => {
            jQuery(`<li class="gallery-list__item">
                        <div class="gallery-list__holder">
                            <div class="gallery-list__overlay">
                                <div class="gallery-list__overlay__box">
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__selection">
                                            <span class="gallery-list__selection__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-check"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">SELECT</span>
                                            </span>
                                            <span class="gallery-list__selection__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">DESELECT</span>
                                            </span>
                                        </a>
                                    </div>
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__favourite">
                                            <span class="gallery-list__favourite__select" style="display:
                                             none;">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-start-rate"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">mark as favorite</span>
                                            </span>
                                            <span class="gallery-list__favourite__unselect"  style="display: block;">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">unmark favorite</span>
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span class="gallery-list__item__selected">
                                <i class="icon ico-check"></i>
                            </span>
                            <span class="gallery-list__overlay__favourite" style="display: block;">
                                <i class="icon ico-start-rate"></i>
                            </span>
                            <img src="${item.url}" alt="gallery image">
                        </div>
                    </li>`).appendTo(urlList);
        });
    },

    /* sb favorite images fuction */
    favouriteSelection: function () {
        jQuery(document).on('click', '.gallery-list__favourite', function(e) {
            e.preventDefault();
            var _self = jQuery(this);
            _self.parents('.gallery-list__holder').find('.gallery-list__overlay__favourite').toggle();
            _self.find('.gallery-list__favourite__select').toggle();
            _self.find('.gallery-list__favourite__unselect').toggle();
            var selectionLenght = _self.parents('.gallery-list').find('.gallery-list__overlay__favourite').is(":visible");
            if(selectionLenght) {
                jQuery('.btn-insert-image').prop("disabled", false);
            }
            else {
                jQuery('.btn-insert-image').prop("disabled", true);
            }
        });
    },

    /* sb gallery select function */
    gallerySelect: function () {
        jQuery(document).on('click', '.gallery-list__selection', function(e) {
            e.preventDefault();
            var _self = jQuery(this);
            if(_self.parents('.gallery-list__holder').hasClass('image-selected')) {
                _self.parents('.gallery-list__holder').removeClass('image-selected');
                _self.find('.gallery-list__selection__unselect').hide();
                _self.find('.gallery-list__selection__select').show();
            }
            else {
                _self.parents('.gallery-list').find('.image-selected').removeClass('image-selected');
                _self.parents('.gallery-list__holder').addClass('image-selected');
                _self.parents('.gallery-list').find('.gallery-list__selection__unselect').hide();
                _self.parents('.gallery-list').find('.gallery-list__selection__select').show();
                _self.find('.gallery-list__selection__unselect').show();
                _self.find('.gallery-list__selection__select').hide();
            }

            var selectionLenght =  jQuery(this).parents('.gallery-list').find('.image-selected').length;
            if(selectionLenght) {
                var _parent_self = jQuery(this).parents('.bg-advance-gallery-modal').find('.btn-insert-image');
                _parent_self.prop("disabled", false);
            }
            else {
                _parent_self.prop("disabled", true);
            }
        });
    },

    /* background_images fuction */
    background_images: function () {
        var urlList = jQuery('#background-images');
        backgroundImages.map( (item,i) => {
            jQuery(`<li class="gallery-list__item">
                        <div class="gallery-list__holder">
                            <div class="gallery-list__overlay">
                                <div class="gallery-list__overlay__box">
                                    <div class="gallery-list__overlay__item">
                                        <a href="#" class="gallery-list__selection">
                                            <span class="gallery-list__selection__select">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-check"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">SELECT</span>
                                            </span>
                                            <span class="gallery-list__selection__unselect">
                                                <span class="gallery-list__overlay__icon">
                                                    <i class="icon ico-cross"></i>
                                                </span>
                                                <span class="gallery-list__overlay__text">DESELECT</span>
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <span class="gallery-list__item__selected">
                                <i class="icon ico-check"></i>
                            </span>
                            <img src="${item.url}" alt="gallery image">
                        </div>
                    </li>`).appendTo(urlList);
        });
    },

    /**
     ** dropfile function
     **/
    dropZoneInit: function() {
        function setup(id) {
            let options = {
                thumbnailHeight: 210,
                thumbnailWidth: 140,
                maxFiles: 1,
                url : "/upload-target",
                dictResponseError: "Server not Configured",
                dictFileTooBig: "File too big ({{filesize}}MB). Must be less than {{maxFilesize}}MB.",
                dictCancelUpload: "",
                init: function() {
                    var self = this;
                    //New file added
                    self.on("addedfile", function(file) {
                        if(id === 'main-bg-image') {
                            console.log('main-bg-image');
                            jQuery('.bg-options-area, .bg-options__wrap').slideDown();
                            jQuery('.bg-switcher__main').addClass('has-padding');
                        }
                        else {
                        }
                        //console.log("new file added ", file);
                    });
                    // Send file starts
                    self.on("sending", function(file) {
                        // console.log("upload started", file);
                        if(id == 'main-bg-image') {
                            $("#main-bg-image-holder").append(file.previewTemplate);
                        }
                        if(id == 'form-bg-image') {
                            $(file.previewTemplate).insertAfter('#form-bg-image-holder .dz-message');
                        }
                    });

                    self.on("complete", function(file, response) {
                        console.log(this);
                        if(id == 'main-bg-image') {
                            jQuery("#main-bg-image-holder").addClass('image-added');
                        }

                        if(id == 'form-bg-image') {
                            bgAdvance.initImageareaSelection();
                            jQuery("#form-bg-image-holder").addClass('image-added');
                        }
                    });

                    self.on("maxfilesreached", function(file, response) {
                        //alert("too big");
                    });

                    self.on("maxfilesexceeded", function(file, response) {
                        this.removeFile(file);
                    });

                    self.on("removedfile", function(file) {
                        if(id === 'main-bg-image') {
                            jQuery('.bg-options-area').slideUp();
                            jQuery("#main-bg-image-holder").removeClass('image-added');
                        }

                        if(jQuery('#bg-main-switcher').prop('checked')==true) {
                            jQuery('.bg-options-area').slideUp();
                        }

                        else {
                            jQuery('.bg-options-area, .bg-options__wrap').slideUp();
                        }

                        if(id == 'form-bg-image') {
                            jQuery("#form-bg-image-holder").removeClass('image-added');
                        }
                    });

                    self.on("addedfile", function(file) {
                        const pattern = /\d{6}(\.)(jpg|jpeg|png)/;

                        if (!pattern.test(file.name)) {
                            //this.removeFile(file);
                        }
                    });

                    self.on("totaluploadprogress", function (progress) {
                        $(".the-progress-text").text(parseInt(progress) + '%');
                    });
                },
                previewTemplate: `
						<div class="dz-preview dz-file-preview">
							<div class="dz-wrap">
							  <div class="dz-image"><img data-dz-thumbnail class="bg-image"/></div>
							  <div class="dz-image-detail">
                                  <div class="dz-filename"><span data-dz-name></span></div>
                                  <div class="dz-progress">
                                    <span class="dz-upload" data-dz-uploadprogress></span>
                                  </div>
                                  <span class="the-progress-text"></span>
                              </div>
							  <div class="dz-remove">
							    <a href="javascript:undefined;" data-dz-remove="" class="remove-dropzone-image"><i class="icon ico-cross"></i> Delete</a>
							  </div>
							</div>
						</div>`
            };
            try {
                var myDropzone = new Dropzone(`#${id}`, options);
            } catch (e) {
                console.log('dropzone issue: ', e);
            }
        }
        setup("main-bg-image");
        setup("form-bg-image");
    },

    /*
    * Scroll poistion funcation
    * */
    scroll_poistion: function () {
        var select_button = jQuery(".funnel-overlay-opener").offset();
        var select_button2 = jQuery(".funnel-bg-opener").offset();
        var select_button3 = jQuery(".background-overlay-opener").offset();
        var select_button4 = jQuery(".background-bg-opener").offset();
        var window_height = jQuery(window).height();
        var select_dropdown = jQuery('.color-box__panel-wrapper').height();
        var select_total = select_button.top + select_dropdown;
        var select_total2 = select_button2.top + select_dropdown;
        var select_total3 = select_button3.top + select_dropdown;
        var select_total4 = select_button4.top + select_dropdown;
        if(window_height < select_total){
            jQuery(".color-box__panel-wrapper.funnel-overlay-color").offset({top:select_button.top-select_dropdown-44, left:select_button.left-174});
        }
        else {
            jQuery(".color-box__panel-wrapper.funnel-overlay-color").offset({top:select_button.top+46, left:select_button.left-174});
        }
        if (window_height < select_total2){
            jQuery(".color-box__panel-wrapper.funnel-bg-color").offset({top:select_button2.top-select_dropdown-44, left:select_button2.left-174});
        }
        else {
            jQuery(".color-box__panel-wrapper.funnel-bg-color").offset({top:select_button2.top+46, left:select_button2.left-174});
        }
        if (window_height < select_total3){
            jQuery(".color-box__panel-wrapper.background-overlay-color").offset({top:select_button3.top-select_dropdown-44, left:select_button3.left-174});
        }
        else {
            jQuery(".color-box__panel-wrapper.background-overlay-color").offset({top:select_button3.top+46, left:select_button3.left-174});
        }
        if (window_height < select_total4){
            jQuery(".color-box__panel-wrapper.background-bg-color").offset({top:select_button4.top-select_dropdown-44, left:select_button4.left-174});
        }
        else {
            jQuery(".color-box__panel-wrapper.background-bg-color").offset({top:select_button4.top+46, left:select_button4.left-174});
        }
    },

    /*
    ** range slider
    **/
    rangeSliderInit: function() {
        jQuery('#bg__shadow-slider').bootstrapSlider({
            formatter: function(value) {
                return value + '%' ;
            },
            tooltip_position:'bottom',
            value: 60,
            tooltip: 'always'
        });

        jQuery('#bg__corner-radius').bootstrapSlider({
            formatter: function(value) {
                return value + 'px' ;
            },
            tooltip_position:'bottom',
            min: 0,
            max: 28,
            value: 10,
            tooltip: 'always'
        });

        $('#image-handler').bootstrapSlider({
            min: 50,
            max: 100,
            step: 1,
            value: 1,
            tooltip: 'hide',
        }).on("change", function(slideEvt) {
            $('#form-bg-image-holder .bg-image').css('transform','scale('+slideEvt.value.newValue/50+')');
        });
    },

    /*
    * scroll area
    * */
    initCustomScroll: function () {
        jQuery(".custom-scroll-holder").mCustomScrollbar({
            axis: "y",
            autoExpandScrollbar: true,
            autoHideScrollbar: false,
            mouseWheel: {
                scrollAmount: 100
            },
            callbacks:{
                whileScrolling:function(){
                    bgAdvance.scroll_poistion();
                    let dropDownActiveClass = jQuery('.dz-message.open').length;
                    if(dropDownActiveClass) {
                        bgAdvance.initDropDownPosition();
                    }
                },
            },
        });
    },

    /*
    * Accordion
    * */
    initAccordion: function () {
        jQuery('body').on('change', '.bg-list-accordion input[type="radio"]', function(){
            jQuery(this).parents('.bg-list-accordion').find('.bg-list-accordion__slide').slideUp();
            jQuery(this).parents('.bg-list-accordion__item').find('.bg-list-accordion__slide').slideDown();
            jQuery(this).parents('.bg-list-accordion').find('.bg-list-accordion__item').removeClass('active');
            jQuery(this).parents('.bg-list-accordion__item').addClass('active');
        });

        jQuery('body').on('change', '#bg-content-switcher', function(){
            jQuery(this).parents('.right-block-holder').find('.bg-slide-holder').slideToggle();
        });

        jQuery('body').on('change', '#bg-form-switcher', function(){
            jQuery(this).parents('.bg-options__wrap').toggleClass('switcher-active');
            if(jQuery('#bg-form-switcher').prop('checked')==true) {
                jQuery(this).parents('.bg-options__wrap').find('.bg-options-slide').slideDown(function(){
                    jQuery(".custom-scroll-holder").mCustomScrollbar("scrollTo","bottom");
                });
            }
            else {
                jQuery(this).parents('.bg-options__wrap').find('.bg-options-slide').slideUp();
            }
        });

        jQuery('body').on('change', '#bg-main-switcher', function(){
            jQuery(this).parents('.bg-options__wrap').toggleClass('switcher-active');

            if(jQuery('#bg-main-switcher').prop('checked')==true) {
                jQuery(this).parents('.bg-options__wrap').find('.bg-options-slide').slideDown(function () {
                    jQuery(".custom-scroll-holder").mCustomScrollbar("scrollTo","bottom");
                });
            }
            else {
                if(jQuery(this).parents('.bg-options__wrap').find('.bg-options-area').is(':visible')){
                    jQuery(this).parents('.bg-options__wrap').find('.bg-options-slide').slideUp();
                }
                else {
                    jQuery(this).parents('.bg-options__wrap').find('.bg-options-slide').slideUp();
                }
            }
        });
    },

    /*
    * Apply button handler on color section
    * */
    initButtonState: function () {
        jQuery('.color-options-list input[type="checkbox"]').change(function () {
            var getLenght = jQuery(this).parents('.color-options-list').find('input[type="checkbox"]:checked').length;
            if(getLenght > 0) {
                jQuery(this).parents('.modal').find('.button-primary').attr('disabled', false);
            }
            else {
                jQuery(this).parents('.modal').find('.button-primary').attr('disabled', true);
            }
        });
    },

    /*
    ** Color Picker Function
   **/

    color_picker: function () {
        jQuery('#background-bg-opener').click(function () {
            var name = ".background-bg-color";
            var color_box_name = $(name);
            var get_color = $(this).find('.last-selected__code').text();
            lpUtilities.custom_color_picker.call(this, name);
            lpUtilities.set_colorpicker_box(color_box_name, get_color);
        });

        jQuery('#background-bg-color').ColorPicker({
            color: "#f6f8f8",
            flat: true,
            opacity: true,
            width: 203,
            height: 144,
            outer_height: 162,
            outer_width: 281,
            onShow: function (colpkr) {
                $(colpkr).fadeIn(100);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(100);
                return false;
            },
            onChange: function (hsb, hex, rgb, rgba) {
                var rgba_fn = 'rgba(' + rgba.r + ', ' + rgba.g + ', ' + rgba.b + ', ' + rgba.a + ')';
                jQuery(".background-bg-color .color-box__r .color-box__rgb").val(rgb.r);
                jQuery(".background-bg-color .color-box__g .color-box__rgb").val(rgb.g);
                jQuery(".background-bg-color .color-box__b .color-box__rgb").val(rgb.b);
                jQuery(".background-bg-color .color-box__hex-block").val('#' + hex);
                jQuery('#background-bg-opener').find('.last-selected__box').css('backgroundColor', rgba_fn);
                jQuery('#background-bg-opener').find('.last-selected__code').text('#' + hex);
            }
        });

        jQuery('#background-overlay-opener').click(function () {
            var name = ".background-overlay-color";
            var color_box_name = $(name);
            var get_color = $(this).find('.last-selected__code').text();
            lpUtilities.custom_color_picker.call(this, name);
            lpUtilities.set_colorpicker_box(color_box_name, get_color);
        });

        jQuery('#background-overlay-color').ColorPicker({
            color: "#f6f8f8",
            flat: true,
            opacity: true,
            width: 203,
            height: 144,
            outer_height: 162,
            outer_width: 281,
            onShow: function (colpkr) {
                $(colpkr).fadeIn(100);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(100);
                return false;
            },
            onChange: function (hsb, hex, rgb, rgba) {
                var rgba_fn = 'rgba(' + rgba.r + ', ' + rgba.g + ', ' + rgba.b + ', ' + rgba.a + ')';
                jQuery(".background-overlay-color .color-box__r .color-box__rgb").val(rgb.r);
                jQuery(".background-overlay-color .color-box__g .color-box__rgb").val(rgb.g);
                jQuery(".background-overlay-color .color-box__b .color-box__rgb").val(rgb.b);
                jQuery(".background-overlay-color .color-box__hex-block").val('#' + hex);
                jQuery('#background-overlay-opener').find('.last-selected__box').css('backgroundColor', rgba_fn);
                jQuery('#background-overlay-opener').find('.last-selected__code').text('#' + hex);
            }
        });

        jQuery('#funnel-bg-opener').click(function () {
            var name = ".funnel-bg-color";
            var color_box_name = $(name);
            var get_color = $(this).find('.last-selected__code').text();
            lpUtilities.custom_color_picker.call(this, name);
            lpUtilities.set_colorpicker_box(color_box_name, get_color);
        });

        jQuery('#funnel-bg-color').ColorPicker({
            color: "#f6f8f8",
            flat: true,
            opacity: true,
            width: 203,
            height: 144,
            outer_height: 162,
            outer_width: 281,
            onShow: function (colpkr) {
                $(colpkr).fadeIn(100);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(100);
                return false;
            },
            onChange: function (hsb, hex, rgb, rgba) {
                var rgba_fn = 'rgba(' + rgba.r + ', ' + rgba.g + ', ' + rgba.b + ', ' + rgba.a + ')';
                jQuery(".funnel-bg-color .color-box__r .color-box__rgb").val(rgb.r);
                jQuery(".funnel-bg-color .color-box__g .color-box__rgb").val(rgb.g);
                jQuery(".funnel-bg-color .color-box__b .color-box__rgb").val(rgb.b);
                jQuery(".funnel-bg-color .color-box__hex-block").val('#' + hex);
                jQuery('#funnel-bg-opener').find('.last-selected__box').css('backgroundColor', rgba_fn);
                jQuery('#funnel-bg-opener').find('.last-selected__code').text('#' + hex);
            }
        });

        jQuery('#funnel-overlay-opener').click(function () {
            var name = ".funnel-overlay-color";
            var color_box_name = $(name);
            var get_color = $(this).find('.last-selected__code').text();
            lpUtilities.custom_color_picker.call(this, name);
            lpUtilities.set_colorpicker_box(color_box_name, get_color);
        });

        jQuery('#funnel-overlay-color').ColorPicker({
            color: "#f6f8f8",
            flat: true,
            opacity: true,
            width: 203,
            height: 144,
            outer_height: 162,
            outer_width: 281,
            onShow: function (colpkr) {
                $(colpkr).fadeIn(100);
                return false;
            },
            onHide: function (colpkr) {
                $(colpkr).fadeOut(100);
                return false;
            },
            onChange: function (hsb, hex, rgb, rgba) {
                var rgba_fn = 'rgba(' + rgba.r + ', ' + rgba.g + ', ' + rgba.b + ', ' + rgba.a + ')';
                jQuery(".funnel-overlay-color .color-box__r .color-box__rgb").val(rgb.r);
                jQuery(".funnel-overlay-color .color-box__g .color-box__rgb").val(rgb.g);
                jQuery(".funnel-overlay-color .color-box__b .color-box__rgb").val(rgb.b);
                jQuery(".funnel-bg-color .color-box__hex-block").val('#' + hex);
                jQuery('#funnel-overlay-opener').find('.last-selected__box').css('backgroundColor', rgba_fn);
                jQuery('#funnel-overlay-opener').find('.last-selected__code').text('#' + hex);
            }
        });
     },

    /**
     ** sb over change
     **/
    initGalleryDropdown: function() {
        jQuery(document).on('click', '.bg-main__dropzone .dz-message__opener', function () {
            var offset = this.getBoundingClientRect();
            var offsetTop = offset.top;
            var offsetLeft = offset.left;
            jQuery(this).parent().find('.gallery-dropdown').css('top', offsetTop);
            jQuery(this).parent().find('.gallery-dropdown').css('left', offsetLeft);
            jQuery(this).parent().find('.gallery-dropdown').toggle();
            jQuery(this).parent().toggleClass('open');
        });
    },

    /**
     ** sb over change
     **/
    initOutsideClick: function () {
        jQuery(document).click(function(e) {
            var target = e.target;
            if(jQuery(".dz-message").hasClass('open')) {
                if (jQuery(target).parents('.dz-message').length > 0 || jQuery(target).hasClass('open') == true) {
                }
                else {
                    jQuery('.gallery-dropdown').hide();
                    jQuery('.gallery-dropdown').parent().removeClass('open');
                }
            }
        });
    },

    initDropDownPosition: function () {
        var offset = jQuery('.dz-message.open')[0].getBoundingClientRect();
        var offsetTop = offset.top;
        jQuery('.dz-message.open').find('.gallery-dropdown').css('top', offsetTop);
    },

    initAddImage: function() {
        jQuery('.modal-opener').click(function(){
           jQuery(this).parents('.dropzone').addClass('append-image');
        });

        jQuery('.btn-insert-image').click(function(){
            var getImageSrc = jQuery(this).parents('.bg-advance-gallery-modal').find('.image-selected img').attr('src');
            console.log(getImageSrc);
            var appendItem = `<div class="bg-image-preview-holder">
                                <div class="bg-progress-area">
                                    <span class="file-name"></span>
                                    <div class="progress-bar-holder">
                                        <div class="progress-bar" style=" width: 0;"></div>
                                    </div>
                                    <span class="progress-val">0%</span>
                                </div>
                                <div class="bg-image-preview" style="display: none;">
                                    <img class="pre-image bg-image" src="${getImageSrc}" alt="">
                                </div>
                                <div class="bg-image-remove-hover">
                                    <a href="#" class="bg-image-remove"><i class="icon ico-cross"></i> Delete</a>
                                  </div>
                            </div>`;
            var src = getImageSrc.split('/');
            var file = src[src.length - 1];
            jQuery(appendItem).insertAfter('.append-image .dz-message');
            var i = 1;
            jQuery(".bg-progress-area .file-name").html(file);
            var elem = jQuery(".bg-progress-area .progress-bar");
            var elemVal = jQuery('.bg-progress-area .progress-val');
            var width = 1;
            var id = setInterval(frame, 10);
            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width++;
                    elem.css('width', width + "%");
                    elemVal.html(width + "%");
                }
            }
            setTimeout(function(){
                jQuery('.bg-progress-area').hide();
                jQuery('.bg-image-preview').show();
                jQuery('.bg-image-preview').parents('.dropzone').addClass('image-added');
                jQuery('.bg-options-area').slideDown(function () {
                    jQuery(".custom-scroll-holder").mCustomScrollbar("scrollTo","bottom");
                    bgAdvance.initImageareaSelection();
                });
                jQuery('.bg-switcher__main').addClass('has-padding');
            }, 1500);
        });

        jQuery('body').on('click', '.bg-image-remove', function(e){
            e.preventDefault();
            jQuery('.bg-options-area').slideUp();
            jQuery(this).parents('.dropzone').removeClass('image-added');
            jQuery(this).parents('.bg-image-preview-holder').remove();
        });
    },

    initModalReset: function () {
        jQuery('.bg-advance-gallery-modal').on('hidden.bs.modal', function () {
            jQuery('.dropzone').removeClass('append-image');
            jQuery('.btn-insert-image').prop("disabled", true);
            jQuery('.gallery-list__holder').removeClass('image-selected');
            jQuery('.gallery-list__selection__unselect').hide();
            jQuery('.gallery-list__selection__select').show();
        });
    },

    initImageareaSelection: function() {
        var canvas = this.__canvas = new fabric.Canvas('canvas');

        fabric.Object.prototype.transparentCorners = false;
        fabric.Object.prototype.cornerColor = 'white';
        fabric.Object.prototype.cornerStyle = 'square';
        canvas.setHeight(document.getElementById("canvas-parent").clientHeight);
        canvas.setWidth(document.getElementById("canvas-parent").clientWidth);

        function Add() {
            var rect = new fabric.Rect({
                left: 50,
                top: 50,
                fill: 'rgba(0,0,0,0.0)',
                width: 50,
                height: 50,
                cornerSize: 8,
                objectCaching: false,
                stroke: 'transparent',
                strokeWidth: 0,
            });

            rect.setControlsVisibility({
                ml: false,
                mt: false,
                mr: false,
                mb: false,
                mtr: false
            });
            canvas.add(rect);
            canvas.setActiveObject(rect);
            Overlay(rect);
        }

        Add();

        canvas.on('object:moving', function (e) {
            boundObj(e);
        });

        canvas.on('object:modified', function (e) {
            boundObj(e);
        });

        var left1 = 0;
        var top1 = 0 ;
        var scale1x = 0 ;
        var scale1y = 0 ;
        var width1 = 0 ;
        var height1 = 0 ;
        canvas.on('object:scaling', function (e){
            var obj = e.target;
            obj.setCoords();
            var brNew = obj.getBoundingRect();

            if (((brNew.width+brNew.left)>=obj.canvas.width) || ((brNew.height+brNew.top)>=obj.canvas.height) || ((brNew.left<0) || (brNew.top<0))) {
                obj.left = left1;
                obj.top=top1;
                obj.scaleX=scale1x;
                obj.scaleY=scale1y;
                obj.width=width1;
                obj.height=height1;
            }
            else{
                left1 =obj.left;
                top1 =obj.top;
                scale1x = obj.scaleX;
                scale1y=obj.scaleY;
                width1=obj.width;
                height1=obj.height;
            }
        });

        function boundObj(bound) {
            var obj = bound.target;
            // if object is too big ignore
            if(obj.currentHeight > obj.canvas.height || obj.currentWidth > obj.canvas.width){
                return;
            }
            obj.setCoords();
            // top-left  corner
            if(obj.getBoundingRect().top < 0 || obj.getBoundingRect().left < 0){
                obj.top = Math.max(obj.top, obj.top-obj.getBoundingRect().top);
                obj.left = Math.max(obj.left, obj.left-obj.getBoundingRect().left);
            }
            // bot-right corner
            if(obj.getBoundingRect().top+obj.getBoundingRect().height  > obj.canvas.height || obj.getBoundingRect().left+obj.getBoundingRect().width  > obj.canvas.width){
                obj.top = Math.min(obj.top, obj.canvas.height-obj.getBoundingRect().height+obj.top-obj.getBoundingRect().top);
                obj.left = Math.min(obj.left, obj.canvas.width-obj.getBoundingRect().width+obj.left-obj.getBoundingRect().left);
            }
            Overlay(obj);
        }


        function Overlay(obj) {
            var img = $("#form-bg-image-holder .bg-image");
            var top = obj.getBoundingRect().top;
            var left = obj.getBoundingRect().left;
            var height = parseInt(obj.getBoundingRect().height);
            var width = parseInt(obj.getBoundingRect().width);
            var right = parseInt(img.width())-parseInt(obj.getBoundingRect().left + width);
            var bottom = parseInt(img.height())-(parseInt(obj.getBoundingRect().top)+height);
            $('.overlay-top').css({'height':top});
            $('.overlay-left').css({'width':left,'top':top,'height':height});
            $('.overlay-right').css({'width':right,'top':top,'height':height});
            $('.overlay-bottom').css({'height':bottom});
        }
    },

    init: function () {
        bgAdvance.dropZoneInit();
        bgAdvance.rangeSliderInit();
        bgAdvance.initAccordion();
        bgAdvance.initCustomScroll();
        bgAdvance.initButtonState();
        bgAdvance.browse_images();
        bgAdvance.recent_images();
        bgAdvance.favorite_images();
        bgAdvance.favouriteSelection();
        bgAdvance.gallerySelect();
        bgAdvance.allCustomSelect();
        bgAdvance.background_images();
        bgAdvance.color_picker();
        bgAdvance.initGalleryDropdown();
        bgAdvance.initOutsideClick();
        bgAdvance.initAddImage();
        bgAdvance.initModalReset();
    },
};

jQuery(document).ready(function () {
    bgAdvance.init();
});

jQuery(window).scroll(function(){
    let dropDownActiveClass = jQuery('.dz-message.open').length;
    if(dropDownActiveClass) {
        bgAdvance.initDropDownPosition();
    }
});

Dropzone.autoDiscover = false;
